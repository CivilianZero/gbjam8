pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--main
function _init()
 t=0
 
 dirx={-1,1,0,0}
 diry={0,0,-1,1}
 
 slime_ani={32}
 slime_hp={}
 slime_atk={}
 slime_mov={2}
 
	menu_init()
end

function menu_init()
	_upd=update_menu
	_drw=draw_menu
end

function game_start()
 c_ani={1,3}
 cx=1
 cy=1
 
 slimes={}
 debug={}
 
 for x=0,15 do
 	for y=0,15 do
 		if mget(x,y)==32 then
 			addslime(1,x/2,y/2)
 			mset(x,y,65)
 			mset(x+1,y,66)
 			mset(x,y+1,81)
 			mset(x+1,y+1,82)
			end
		end
 end
 
 slctd=nil
 
	_upd=update_game
	_drw=draw_game
end
-->8
--update
function _update()
 t+=1
 _upd()
end

function update_menu()
	if (btn(❎)) game_start()
end

function update_game()
	for i=0,3 do
		if btnp(i) then
			cx+=dirx[i+1]
			cy+=diry[i+1]
		end
	end
	if btnp(❎) then
	 if not slctd then
	 	slctd=getslime(cx,cy)
	 elseif slctd then
	  moveslime()
  end
		--select unit/confirm
	end
	if btnp(🅾️) then
		--cancel/menu
	end
	if (#debug>4) debug={}
end
-->8
--draw
function _draw()
 _drw()
 color(8)
	foreach(debug,print)
end

function draw_menu()
 cls()
	print("press ❎ to start",31,63,7)
end

function draw_game()
	cls()
	map()
	for s in all(slimes) do
		drawspr(animate(s.ani),
		        s.x,s.y,
		        s.flip)
	end
	drawspr(
	 animate(c_ani),
	 cx,
	 cy,false)
	 
	if (slctd) displaymv()
end

function drawspr(_spr,_x,_y,_flip)
	palt(0,false)
	palt(1,true)
	spr(_spr,_x*16,_y*16,2,2,_flip)
	pal()
end

function animate(ani)
	return ani[flr(t/15)%#ani+1]
end

function displaymv()
	local dist,sx,sy=slctd.mov,slctd.x,slctd.y
	local maxd=dist
	while dist>0 do 
	 for i=1,4 do
	  drawspr(5,sx+(dirx[i]*dist),sy+(diry[i]*dist))
	  if dist!=maxd then
	  	add(debug,maxd)
   end
	 end
	 dist-=1
 end
end
-->8
--utility
-->8
--slimes
function addslime(typ,_x,_y)
	local s={
	 x=_x,
	 y=_y,
	 ox=0,
	 oy=0,
	 flp=false,
	 mov=slime_mov[typ],
	 hasmvd=false,
	 hasatkd=false,
	 ani={}
	}
	for i=0,2 do
		add(s.ani,slime_ani[typ]+(i*2))
	end
	add(slimes,s)
end

function getslime(x,y)
	for s in all(slimes) do
		if s.x==x and s.y==y then
			return s
		end
	end
	return nil
end

function moveslime()
	
end
-->8
--ui/cursor
__gfx__
00000000777777711777777711111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000700055711755000717777777777777711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00700700707777711777770717000557755000711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00077000707111111111170717077777777770711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00077000757111111111175717071111111170711111777777771111000000000000000000000000000000000000000000000000000000000000000000000000
00700700757111111111175717571111111175711111700000071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000777111111111177717571111111175711111707777071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111117771111111177711111707777071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111117771111111177711111707777071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000777111111111177717571111111175711111707777071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000757111111111175717571111111175711111700000071111000000000000000000000000000000000000000000000000000000000000000000000000
00000000757111111111175717071111111170711111777777771111000000000000000000000000000000000000000000000000000000000000000000000000
00000000707111111111170717077777777770711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000707777711777770717000557755000711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000700055711755000717777777777777711111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777711777777711111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111777777771111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11117777777711111111766666671111111177777777111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11117666666711111177766666677711111176666667111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11777666666777111176600666666711117776666667771100000000000000000000000000000000000000000000000000000000000000000000000000000000
11766006666667117776600666666777117660066666671100000000000000000000000000000000000000000000000000000000000000000000000000000000
77766006666667777660066666666667777660066666677700000000000000000000000000000000000000000000000000000000000000000000000000000000
76600666666666677660066666666667766006666666666700000000000000000000000000000000000000000000000000000000000000000000000000000000
76600666666666677666666666666667766006666666666700000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666677666666666666667766666666666666700000000000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666677776666666666777766666666666666700000000000000000000000000000000000000000000000000000000000000000000000000000000
77766666666667771176666666666711777666666666677700000000000000000000000000000000000000000000000000000000000000000000000000000000
11766666666667111177777777777711117666666666671100000000000000000000000000000000000000000000000000000000000000000000000000000000
11777777777777111111111111111111117777777777771100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241422021414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251523031515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142414241424142414241424142414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152515251525152515251525152515200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
