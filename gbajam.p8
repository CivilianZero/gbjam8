pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--main
function _init()
 t=0
 
 dirx={-1,1,0,0}
 diry={0,0,-1,1}
 
 slime_ani={64}
 slime_hp={}
 slime_atk={}
 slime_mov={2}
 
	menu_init()
end

function menu_init()
	_upd=update_menu
	_drw=draw_menu
end

function game_start()
 c_ani={48,49}
 cx=7
 cy=7
 
 slimes={}
 debug={}
 
 for x=0,15 do
 	for y=0,15 do
 		for i=1,#slime_ani do
 			if mget(x,y)==slime_ani[i] then
 			addslime(i,x,y)
 			mset(x,y,1)
			end
			end
		end
 end
 
 slctd=nil
 
	_upd=update_game
	_drw=draw_game
end
-->8
--update
function _update()
 t+=1
 _upd()
end

function update_menu()
	if (btn(❎)) game_start()
end

function update_game()
	for i=0,3 do
		if btnp(i) then
			cx+=dirx[i+1]
			cy+=diry[i+1]
		end
	end
	if btnp(❎) then
	 if not slctd then
	 	slctd=getslime(cx,cy)
	 elseif slctd then
	  moveslime()
  end
		--select unit/confirm
	end
	if btnp(🅾️) then
		slctd=nil
		--cancel/menu
	end
	
	if slctd then
	 c_ani={50,51}
	else
		c_ani={48,49}
	end
	if (#debug>4) debug={}
end
-->8
--draw
function _draw()
 _drw()
 color(8)
	foreach(debug,print)
end

function draw_menu()
 cls()
	print("press ❎ to start",31,63,7)
end

function draw_game()
	cls()
	map()
	for s in all(slimes) do
		drawspr(animate(s.ani),
		        s.x,s.y,
		        s.flip)
	end
	drawspr(
	 animate(c_ani),
	 cx,
	 cy,false)
end

function drawspr(_spr,_x,_y,_flip)
	palt(0,false)
	palt(6,true)
	spr(_spr,_x*8,_y*8,1,1,_flip)
	pal()
end

function animate(ani)
	return ani[flr(t/15)%#ani+1]
end
-->8
--utility
function iswalkable(x,y,mode)
 if (mode==nil) mode=""
 
 if inbounds(x,y) then
  local tle=mget(x,y)
  if fget(tle,0)==false then
   if mode=="checkmobs" then
    return getmob(x,y)==false
   end
   return true
  end
 end
 return false
end
-->8
--slimes
function addslime(typ,_x,_y)
	local s={
	 x=_x,
	 y=_y,
	 ox=0,
	 oy=0,
	 flp=false,
	 mov=slime_mov[typ],
	 hasmvd=false,
	 hasatkd=false,
	 ani={}
	}
	for i=0,3 do
		add(s.ani,slime_ani[typ]+i)
	end
	add(slimes,s)
end

function getslime(x,y)
	for s in all(slimes) do
		if s.x==x and s.y==y then
			return s
		end
	end
	return nil
end

function moveslime()
	
end
-->8
--ui/cursor
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b66b3366666666666bb66666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36666663633bb33666333366666bb666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b666666b636666366366663666333366000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666666666b6666b6b366663b6b3663b6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666666666b6666b6b366663b6b3663b6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b666666b636666366366663666333366000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36666663633bb33666333366666bb666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b66b3366666666666bb66666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666666666ccc6666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66ccc6666c0ccc6666ccc66666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6c0ccc666c0ccc666c0ccc666cccccc6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0ccccc66ccccc66c0ccccc6c00ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccccccc66ccccc66ccccccc6cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccc6666ccc6666ccccc666cccccc6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010140010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
